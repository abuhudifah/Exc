<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† - Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .tab-button {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .glass-card {
                padding: 1.5rem;
            }
            
            .grid-cols-mobile {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .btn-mobile {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .text-mobile-lg {
                font-size: 1.25rem;
            }
            
            .text-mobile-xl {
                font-size: 1.5rem;
            }
            
            .p-mobile {
                padding: 1rem;
            }
            
            /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
            .tabs-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tabs-container::-webkit-scrollbar {
                display: none;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        @media (max-width: 480px) {
            .grid-cols-mobile-sm {
                grid-template-columns: 1fr;
            }
            
            .tab-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .btn-mobile-sm {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .text-mobile-sm {
                font-size: 0.875rem;
            }
            
            .p-mobile-sm {
                padding: 0.75rem;
            }
        }
        
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø·ÙÙŠÙØ© Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .modern-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo-container {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .tab-active { 
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
        }
        
        .tab-inactive { 
            background: rgba(255, 255, 255, 0.9);
            color: #1e3a8a;
            transition: all 0.3s ease;
        }
        
        .tab-inactive:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .loading { 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #1e3a8a; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        .transaction-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(-5px);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(30, 58, 138, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        .btn-admin {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            transition: all 0.3s ease;
        }
        
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .success-toast {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            backdrop-filter: blur(10px);
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .bank-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .bank-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .card-number {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            transition: all 0.3s ease;
        }
        
        .btn-edit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        
        .btn-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .account-actions {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
        }
        
        .account-action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0.8;
            transition: all 0.3s ease;
        }
        
        .account-action-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            transition: all 0.3s ease;
        }
        
        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .btn-share {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .transaction-actions {
            display: flex;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }

        .transaction-action-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }
        
        /* ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ */
        .statement-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .statement-table th,
        .statement-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .statement-table th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        
        .statement-table tr:hover {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="min-h-full">
    <!-- Header -->
    <header class="modern-header text-white p-4 md:p-6">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center space-x-4 space-x-reverse mb-4 md:mb-0">
                <div class="logo-container rounded-full p-2">
                    <img src="https://i.ibb.co/ZzzbL3Rg/image.png" alt="Ø´Ø¹Ø§Ø± Ø´Ø±ÙƒØ© Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ©" class="h-12 w-12 md:h-16 md:w-16 rounded-full object-cover">
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold mb-1">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø§Ù„Ù…ØªØ·ÙˆØ±</h1>
                    <p class="text-sm md:text-lg opacity-90">Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</p>
                </div>
            </div>
            <div class="text-center md:text-left">
                <div class="bg-white bg-opacity-20 rounded-lg p-3 md:p-4 backdrop-filter backdrop-blur-sm">
                    <p class="text-base md:text-lg font-semibold" id="agentName">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù…Ù†Ø¯ÙˆØ¨</p>
                    <p class="text-xs md:text-sm opacity-90" id="currentDate"></p>
                    <p class="text-xs opacity-75" id="currentTime"></p>
                </div>
            </div>
        </div>
    </header>

    <!-- Agent Name Modal -->
    <div id="nameModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-6 md:p-8 w-11/12 md:w-96 mx-4 transform transition-all">
            <div class="text-center mb-4 md:mb-6">
                <div class="logo-container rounded-full p-3 w-16 h-16 md:w-20 md:h-20 mx-auto mb-4">
                    <img src="https://i.ibb.co/ZzzbL3Rg/image.png" alt="Ø´Ø¹Ø§Ø±" class="w-full h-full rounded-full object-cover">
                </div>
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                <p class="text-gray-600 text-sm md:text-base">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            </div>
            <input type="text" id="agentNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" class="w-full p-3 md:p-4 form-input rounded-xl mb-4 md:mb-6 text-right text-base md:text-lg">
            <button type="button" onclick="setAgentName()" class="w-full btn-admin text-white py-3 md:py-4 rounded-xl text-base md:text-lg font-semibold">
                <i class="fas fa-sign-in-alt ml-2"></i>
                Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
            </button>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <nav class="bg-transparent p-2 md:p-4">
        <div class="container mx-auto">
            <div class="tabs-container flex overflow-x-auto space-x-2 space-x-reverse pb-2">
                <button type="button" onclick="showTab('collections')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-active transition-all" id="tab-collections">
                    <i class="fas fa-money-bill-wave ml-2"></i>Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª
                </button>
                <button type="button" onclick="showTab('deposits')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-deposits">
                    <i class="fas fa-university ml-2"></i>Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª
                </button>
                <button type="button" onclick="showTab('expenses')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-expenses">
                    <i class="fas fa-receipt ml-2"></i>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
                </button>
                <button type="button" onclick="showTab('deliveries')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-deliveries">
                    <i class="fas fa-exchange-alt ml-2"></i>Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªØ³Ù„ÙŠÙ…
                </button>
                <button type="button" onclick="showTab('summary')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-summary">
                    <i class="fas fa-chart-line ml-2"></i>Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…
                </button>
                <button type="button" onclick="showTab('accounts')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-accounts">
                    <i class="fas fa-credit-card ml-2"></i>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                </button>
                <button type="button" onclick="showTab('statement')" class="tab-button px-4 md:px-6 py-3 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-statement">
                    <i class="fas fa-file-invoice ml-2"></i>ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto p-3 md:p-6">
        <!-- Collections Tab -->
        <div id="collections-tab" class="tab-content fade-in">
            <div class="glass-card rounded-2xl p-4 md:p-8">
                <div class="flex items-center mb-6 md:mb-8">
                    <div class="bg-green-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                        <i class="fas fa-money-bill-wave text-green-600 text-lg md:text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª</h2>
                        <p class="text-gray-600 text-sm md:text-base">Ø¥Ø¶Ø§ÙØ© ØªØ­ØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                    </div>
                </div>
                <form id="collectionForm" class="space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div>
                            <label for="customerName" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-user ml-2"></i>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
                            </label>
                            <input type="text" id="customerName" list="customersList" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                            <datalist id="customersList"></datalist>
                        </div>
                        <div>
                            <label for="collectionType" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-list ml-2"></i>Ù†ÙˆØ¹ Ø§Ù„ØªØ­ØµÙŠÙ„
                            </label>
                            <select id="collectionType" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" required onchange="toggleCollectionBankAccount()">
                                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­ØµÙŠÙ„</option>
                                <option value="Ù†Ù‚Ø¯ÙŠ">ğŸ’µ Ù†Ù‚Ø¯ÙŠ</option>
                                <option value="Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">ğŸ’³ Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</option>
                                <option value="Ø§Ø³ØªÙ„Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ø£Ø®Ø±Ù‰">ğŸ¢ Ø§Ø³ØªÙ„Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div id="collectionBankAccountContainer" class="hidden">
                            <label for="collectionBankAccount" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-credit-card ml-2"></i>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ù„Ø³Ø­Ø¨
                            </label>
                            <select id="collectionBankAccount" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>
                            </select>
                        </div>
                        <div>
                            <label for="collectionAmount" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-dollar-sign ml-2"></i>Ø§Ù„Ù…Ø¨Ù„Øº
                            </label>
                            <input type="number" id="collectionAmount" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="0.00" step="0.01" required>
                        </div>
                        <div>
                            <label for="collectionNotes" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-sticky-note ml-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                            </label>
                            <input type="text" id="collectionNotes" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                        </div>
                    </div>
                    <button type="submit" class="w-full btn-admin text-white py-3 md:py-4 rounded-xl text-base md:text-lg font-semibold">
                        <span class="loading hidden ml-2" id="collectionLoading"></span>
                        <i class="fas fa-plus ml-2"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­ØµÙŠÙ„
                    </button>
                </form>
            </div>
        </div>

        <!-- Deposits Tab -->
        <div id="deposits-tab" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-4 md:p-8">
                <div class="flex items-center mb-6 md:mb-8">
                    <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                        <i class="fas fa-university text-blue-600 text-lg md:text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</h2>
                        <p class="text-gray-600 text-sm md:text-base">Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</p>
                    </div>
                </div>
                <form id="depositForm" class="space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div>
                            <label for="bankAccount" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-university ml-2"></i>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
                            </label>
                            <select id="bankAccount" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>
                            </select>
                        </div>
                        <div>
                            <label for="depositAmount" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-dollar-sign ml-2"></i>Ø§Ù„Ù…Ø¨Ù„Øº
                            </label>
                            <input type="number" id="depositAmount" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="md:col-span-2">
                            <label for="depositNotes" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-sticky-note ml-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                            </label>
                            <input type="text" id="depositNotes" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 md:gap-4">
                        <button type="submit" class="flex-1 btn-admin text-white py-3 md:py-4 rounded-xl text-base md:text-lg font-semibold">
                            <span class="loading hidden ml-2" id="depositLoading"></span>
                            <i class="fas fa-plus ml-2"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹
                        </button>
                        <button type="button" onclick="showAddAccountModal()" class="px-4 md:px-8 py-3 md:py-4 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all text-base md:text-lg">
                            <i class="fas fa-credit-card ml-2"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expenses-tab" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-4 md:p-8">
                <div class="flex items-center mb-6 md:mb-8">
                    <div class="bg-red-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                        <i class="fas fa-receipt text-red-600 text-lg md:text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h2>
                        <p class="text-gray-600 text-sm md:text-base">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
                    </div>
                </div>
                <form id="expenseForm" class="space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div>
                            <label for="expenseType" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-tags ml-2"></i>Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ
                            </label>
                            <select id="expenseType" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" required>
                                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</option>
                                <option value="ÙˆÙ‚ÙˆØ¯">â›½ ÙˆÙ‚ÙˆØ¯</option>
                                <option value="ØµÙŠØ§Ù†Ø©">ğŸ”§ ØµÙŠØ§Ù†Ø©</option>
                                <option value="Ø£Ø®Ø±Ù‰">ğŸ“‹ Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label for="expenseAmount" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-dollar-sign ml-2"></i>Ø§Ù„Ù…Ø¨Ù„Øº
                            </label>
                            <input type="number" id="expenseAmount" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="md:col-span-2">
                            <label for="expenseDescription" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-align-left ml-2"></i>Ø§Ù„ÙˆØµÙ
                            </label>
                            <input type="text" id="expenseDescription" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full btn-admin text-white py-3 md:py-4 rounded-xl text-base md:text-lg font-semibold">
                        <span class="loading hidden ml-2" id="expenseLoading"></span>
                        <i class="fas fa-plus ml-2"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ
                    </button>
                </form>
            </div>
        </div>

        <!-- Deliveries Tab -->
        <div id="deliveries-tab" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-4 md:p-8">
                <div class="flex items-center mb-6 md:mb-8">
                    <div class="bg-purple-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                        <i class="fas fa-exchange-alt text-purple-600 text-lg md:text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</h2>
                        <p class="text-gray-600 text-sm md:text-base">Ø§Ø³ØªÙ„Ø§Ù… Ø£Ùˆ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</p>
                    </div>
                </div>
                <form id="deliveryForm" class="space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div>
                            <label for="deliveryType" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-exchange-alt ml-2"></i>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                            </label>
                            <select id="deliveryType" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" required onchange="toggleDeliveryFields()">
                                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</option>
                                <option value="receive">ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù…</option>
                                <option value="send">ğŸ“¤ ØªØ³Ù„ÙŠÙ…</option>
                            </select>
                        </div>
                        <div>
                            <label for="deliveryAgent" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-user-friends ml-2"></i>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                            </label>
                            <select id="deliveryAgent" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</option>
                                </select>
                        </div>
                        <div>
                            <label for="deliveryAmount" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-dollar-sign ml-2"></i>Ø§Ù„Ù…Ø¨Ù„Øº
                            </label>
                            <input type="number" id="deliveryAmount" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="md:col-span-2">
                            <label for="deliveryNotes" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                                <i class="fas fa-sticky-note ml-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                            </label>
                            <input type="text" id="deliveryNotes" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªØ³Ù„ÙŠÙ…">
                        </div>
                    </div>
                    <button type="submit" class="w-full btn-admin text-white py-3 md:py-4 rounded-xl text-base md:text-lg font-semibold">
                        <span class="loading hidden ml-2" id="deliveryLoading"></span>
                        <i class="fas fa-paper-plane ml-2"></i>
                        ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    </button>
                </form>
            </div>
        </div>

        <!-- Summary Tab -->
        <div id="summary-tab" class="tab-content hidden">
            <div class="space-y-6 md:space-y-8">
                <!-- Summary Cards -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-6 grid-cols-mobile">
                    <div class="stat-card rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-purple-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4">
                            <i class="fas fa-history text-purple-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</h3>
                        <p class="text-xl md:text-3xl font-bold text-purple-600" id="previousBalance">0</p>
                        <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                    </div>
                    <div class="stat-card rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-green-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4">
                            <i class="fas fa-arrow-up text-green-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª</h3>
                        <p class="text-xl md:text-3xl font-bold text-green-600" id="totalCollections">0</p>
                        <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                    </div>
                    <div class="stat-card rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-blue-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4">
                            <i class="fas fa-university text-blue-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</h3>
                        <p class="text-xl md:text-3xl font-bold text-blue-600" id="totalDeposits">0</p>
                        <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                    </div>
                    <div class="stat-card rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-red-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4">
                            <i class="fas fa-arrow-down text-red-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                        <p class="text-xl md:text-3xl font-bold text-red-600" id="totalExpenses">0</p>
                        <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                    </div>
                    <div class="stat-card rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-indigo-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-3 md:mb-4">
                            <i class="fas fa-wallet text-indigo-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                        <p class="text-xl md:text-3xl font-bold text-gray-800" id="remainingBalance">0</p>
                        <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                    </div>
                </div>

                <!-- Daily Report -->
                <div class="glass-card rounded-2xl p-4 md:p-8">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 md:mb-6">
                        <div class="flex items-center mb-4 md:mb-0">
                            <div class="bg-indigo-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                                <i class="fas fa-chart-line text-indigo-600 text-lg md:text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg md:text-2xl font-bold text-gray-800">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3>
                                <p class="text-gray-600 text-sm md:text-base">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø© Ø§Ù„ÙŠÙˆÙ…</p>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 md:space-x-3 md:space-x-reverse">
                            <button type="button" onclick="shareWorkData()" class="flex-1 md:flex-none px-4 py-2 md:px-6 md:py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-all text-sm md:text-base">
                                <i class="fas fa-share ml-1 md:ml-2"></i>Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„
                            </button>
                            <button type="button" onclick="shareReport()" class="flex-1 md:flex-none px-4 py-2 md:px-6 md:py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all text-sm md:text-base">
                                <i class="fas fa-share-alt ml-1 md:ml-2"></i>Ù…Ø´Ø§Ø±ÙƒØ©
                            </button>
                            <button type="button" onclick="exportToPDF()" class="flex-1 md:flex-none px-4 py-2 md:px-6 md:py-3 bg-red-600 text-white rounded-xl font-semibold hover:bg-red-700 transition-all text-sm md:text-base">
                                <i class="fas fa-file-pdf ml-1 md:ml-2"></i>PDF
                            </button>
                            <button type="button" onclick="exportToExcel()" class="flex-1 md:flex-none px-4 py-2 md:px-6 md:py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all text-sm md:text-base">
                                <i class="fas fa-file-excel ml-1 md:ml-2"></i>Excel
                            </button>
                        </div>
                    </div>
                    <div id="dailyTransactions" class="space-y-3 md:space-y-4"></div>
                </div>
            </div>
        </div>

        <!-- Bank Accounts Tab -->
        <div id="accounts-tab" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-4 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 md:mb-8">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                            <i class="fas fa-credit-card text-blue-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</h2>
                            <p class="text-gray-600 text-sm md:text-base">Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 md:gap-3">
                        <button type="button" onclick="showAddAccountModal()" class="px-4 py-2 md:px-6 md:py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all text-sm md:text-base">
                            <i class="fas fa-plus ml-1 md:ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                        <button type="button" onclick="manualResetDailyLimits()" class="px-4 py-2 md:px-6 md:py-3 btn-reset text-white rounded-xl font-semibold text-sm md:text-base">
                            <i class="fas fa-sync-alt ml-1 md:ml-2"></i>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                        </button>
                    </div>
                </div>
                <div class="mb-4 md:mb-6">
                    <button type="button" onclick="shareAllAccountsReport()" class="w-full md:w-auto px-4 py-2 md:px-6 md:py-3 btn-admin text-white rounded-xl font-semibold text-sm md:text-base">
                        <i class="fas fa-share-alt ml-1 md:ml-2"></i>Ù…Ø´Ø§Ø±ÙƒØ© ØªÙ‚Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                    </button>
                </div>
                <div id="bankAccountsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
            </div>
        </div>

        <!-- Statement Tab -->
        <div id="statement-tab" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-4 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 md:mb-8">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="bg-indigo-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                            <i class="fas fa-file-invoice text-indigo-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl md:text-3xl font-bold text-gray-800">ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</h2>
                            <p class="text-gray-600 text-sm md:text-base">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙˆØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 md:space-x-3 md:space-x-reverse">
                        <button type="button" onclick="generateStatementReport()" class="px-4 py-2 md:px-6 md:py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-all text-sm md:text-base">
                            <i class="fas fa-download ml-1 md:ml-2"></i>ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒØ´Ù
                        </button>
                        <button type="button" onclick="shareStatement()" class="px-4 py-2 md:px-6 md:py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-all text-sm md:text-base">
                            <i class="fas fa-share-alt ml-1 md:ml-2"></i>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙƒØ´Ù
                        </button>
                    </div>
                </div>
                <div id="statementContent" class="space-y-4">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </main>

    <!-- Modals and Other Elements -->
    <!-- Add/Edit Account Modal -->
    <div id="accountModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-4 md:p-8 w-11/12 md:w-full max-w-md mx-4 max-h-screen overflow-y-auto">
            <div class="flex items-center mb-4 md:mb-6">
                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                    <i class="fas fa-credit-card text-blue-600 text-lg md:text-xl"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-gray-800" id="accountModalTitle">Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ø¬Ø¯ÙŠØ¯</h3>
            </div>
            <form id="accountForm" class="space-y-4 md:space-y-6">
                <input type="hidden" id="editAccountId">
                <div>
                    <label for="accountName" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                        <i class="fas fa-university ml-2"></i>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ
                    </label>
                    <input type="text" id="accountName" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ" required>
                </div>
                <div>
                    <label for="accountNumber" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                        <i class="fas fa-hashtag ml-2"></i>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨
                    </label>
                    <input type="text" id="accountNumber" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" required>
                </div>
                <div>
                    <label for="cardNumber" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                        <i class="fas fa-credit-card ml-2"></i>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                    </label>
                    <input type="text" id="cardNumber" class="w-full p-3 md:p-4 form-input rounded-xl card-number text-base md:text-lg" placeholder="0000 0000 0000 0000" maxlength="19" required>
                </div>
                <div>
                    <label for="cardHolder" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                        <i class="fas fa-user ml-2"></i>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                    </label>
                    <input type="text" id="cardHolder" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" required>
                </div>
                <div>
                    <label for="accountLimit" class="block text-sm font-semibold text-gray-700 mb-2 md:mb-3">
                        <i class="fas fa-chart-line ml-2"></i>Ø³Ù‚Ù Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ
                    </label>
                    <input type="number" id="accountLimit" class="w-full p-3 md:p-4 form-input rounded-xl text-base md:text-lg" placeholder="0.00" step="0.01" required>
                </div>
                <div class="flex flex-col md:flex-row gap-3 md:gap-4">
                    <button type="submit" class="flex-1 btn-admin text-white py-3 md:py-4 rounded-xl font-semibold text-base md:text-lg">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸
                    </button>
                    <button type="button" onclick="hideAccountModal()" class="flex-1 bg-gray-500 text-white py-3 md:py-4 rounded-xl font-semibold hover:bg-gray-600 transition-colors text-base md:text-lg">
                        <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="fixed top-4 md:top-6 left-4 md:left-6 right-4 md:right-6 success-toast text-white p-4 md:p-6 rounded-2xl hidden z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-xl md:text-2xl ml-2 md:ml-3"></i>
            <p id="successText" class="text-base md:text-lg font-semibold"></p>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-4 md:p-8 w-11/12 md:w-full max-w-2xl mx-4 max-h-80 md:max-h-96 overflow-y-auto">
            <div class="flex items-center mb-4 md:mb-6">
                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                    <i class="fas fa-share-alt text-blue-600 text-lg md:text-xl"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
            </div>
            <textarea id="shareText" class="w-full h-40 md:h-64 p-3 md:p-4 form-input rounded-xl text-right text-sm md:text-base" readonly></textarea>
            <div class="flex flex-col md:flex-row gap-3 md:gap-4 mt-4 md:mt-6">
                <button type="button" onclick="copyToClipboard()" class="flex-1 btn-admin text-white py-3 md:py-4 rounded-xl font-semibold text-base md:text-lg">
                    <i class="fas fa-copy ml-2"></i>Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                </button>
                <button type="button" onclick="hideShareModal()" class="flex-1 bg-gray-500 text-white py-3 md:py-4 rounded-xl font-semibold hover:bg-gray-600 transition-colors text-base md:text-lg">
                    <i class="fas fa-times ml-2"></i>Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-6 md:p-8 w-11/12 md:w-96 mx-4 transform transition-all">
            <div class="text-center mb-4 md:mb-6">
                <div class="bg-red-100 p-3 md:p-4 rounded-full w-16 h-16 md:w-20 md:h-20 mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-red-600 text-xl md:text-2xl"></i>
                </div>
                <h2 class="text-xl md:text-2xl font-bold text-red-600 mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
                <p class="text-gray-600 text-sm md:text-base" id="deleteConfirmText">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠØŸ</p>
            </div>
            <div class="flex flex-col md:flex-row gap-3 md:gap-4">
                <button type="button" onclick="confirmDelete()" class="flex-1 btn-delete text-white py-3 md:py-4 rounded-xl font-semibold text-base md:text-lg">
                    <i class="fas fa-trash ml-2"></i>Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù
                </button>
                <button type="button" onclick="hideDeleteConfirmModal()" class="flex-1 bg-gray-500 text-white py-3 md:py-4 rounded-xl font-semibold hover:bg-gray-600 transition-colors text-base md:text-lg">
                    <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="editTransactionModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="glass-card rounded-2xl p-4 md:p-8 w-11/12 md:w-full max-w-2xl mx-4 max-h-80 md:max-h-96 overflow-y-auto">
            <div class="flex items-center mb-4 md:mb-6">
                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                    <i class="fas fa-edit text-blue-600 text-lg md:text-xl"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-gray-800">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</h3>
            </div>
            <form id="editTransactionForm" class="space-y-4 md:space-y-6">
                <input type="hidden" id="editTransactionId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                        <select id="editTransactionType" class="w-full p-3 form-input rounded-xl" onchange="toggleEditTransactionFields()">
                            <option value="collection">ØªØ­ØµÙŠÙ„</option>
                            <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹</option>
                            <option value="expense">Ù…ØµØ±ÙˆÙ</option>
                            <option value="delivery">Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ…</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                        <input type="number" id="editTransactionAmount" class="w-full p-3 form-input rounded-xl" required>
                    </div>
                    <div id="editCollectionFields" class="md:col-span-2 space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                            <input type="text" id="editCustomerName" class="w-full p-3 form-input rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªØ­ØµÙŠÙ„</label>
                            <select id="editCollectionType" class="w-full p-3 form-input rounded-xl">
                                <option value="Ù†Ù‚Ø¯ÙŠ">Ù†Ù‚Ø¯ÙŠ</option>
                                <option value="Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</option>
                                <option value="Ø§Ø³ØªÙ„Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ø£Ø®Ø±Ù‰">Ø§Ø³ØªÙ„Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                    </div>
                    <div id="editDepositFields" class="md:col-span-2 hidden">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label>
                        <select id="editBankAccount" class="w-full p-3 form-input rounded-xl">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>
                        </select>
                    </div>
                    <div id="editExpenseFields" class="md:col-span-2 hidden">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                            <select id="editExpenseType" class="w-full p-3 form-input rounded-xl">
                                <option value="ÙˆÙ‚ÙˆØ¯">ÙˆÙ‚ÙˆØ¯</option>
                                <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„ÙˆØµÙ</label>
                            <input type="text" id="editExpenseDescription" class="w-full p-3 form-input rounded-xl">
                        </div>
                    </div>
                    <div id="editDeliveryFields" class="md:col-span-2 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                                <select id="editDeliveryType" class="w-full p-3 form-input rounded-xl">
                                    <option value="receive">Ø§Ø³ØªÙ„Ø§Ù…</option>
                                    <option value="send">ØªØ³Ù„ÙŠÙ…</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
                                <select id="editDeliveryAgent" class="w-full p-3 form-input rounded-xl">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="editTransactionNotes" class="w-full p-3 form-input rounded-xl" rows="3"></textarea>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row gap-2 md:gap-4 mt-4 md:mt-6">
                    <button type="submit" class="flex-1 btn-admin text-white py-3 rounded-xl font-semibold">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                    </button>
                    <button type="button" onclick="hideEditTransactionModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-colors">
                        <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZ9IUXRK-5Kb-TWhQL9nuwse_lmdCzP9g",
            authDomain: "abu-hatheefa-app-68ff1.firebaseapp.com",
            projectId: "abu-hatheefa-app-68ff1",
            storageBucket: "abu-hatheefa-app-68ff1.firebasestorage.app",
            messagingSenderId: "33088080519",
            appId: "1:33088080519:web:d7ee753b3751a0d2828622"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.log('Firebase already initialized');
        }
        const db = firebase.firestore();

        // Global Variables
        let currentAgent = '';
        let dailyTransactions = [];
        let bankAccounts = [];
        let previousBalance = 0;
        let defaultBankAccount = '';
        let accountToDelete = null;
        let allAgentTransactions = [];

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø¨Ø¯ÙˆÙ† ÙƒØ³ÙˆØ± (Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©)
        function formatAmount(amount) {
            return Math.round(amount).toString();
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        function formatDateTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDateTime();
            checkAgentName();
            loadBankAccounts();
            loadCustomers();
            loadAgents();
            loadPreviousBalance();
            loadDailyData();
            loadAllAgentTransactions();
            
            // Set up form listeners
            setupFormListeners();
            
            // Update time every second
            setInterval(updateCurrentDateTime, 1000);
            
            // Format card number input
            setupCardNumberFormatting();
            
            // Check and reset limits at start of new day
            checkAndResetDailyLimits();

            // Setup edit form listener
            document.getElementById('editTransactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateTransaction();
            });
        });

        function updateCurrentDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }

        function setupCardNumberFormatting() {
            const cardInput = document.getElementById('cardNumber');
            if (cardInput) {
                cardInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
                    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                    e.target.value = formattedValue;
                });
            }
        }

        // ========== Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ ==========
        async function checkAndResetDailyLimits() {
            const today = new Date().toISOString().split('T')[0];
            const lastResetDate = localStorage.getItem('lastResetDate');
            
            if (lastResetDate !== today) {
                try {
                    await resetAllBankAccounts();
                    localStorage.setItem('lastResetDate', today);
                    console.log('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯');
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©:', error);
                }
            }
        }

        // ========== Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© ==========
        async function resetAllBankAccounts() {
            try {
                const batch = db.batch();
                
                for (const account of bankAccounts) {
                    const accountRef = db.collection('bankAccounts').doc(account.id);
                    batch.update(accountRef, {
                        currentDeposits: 0,
                        currentWithdrawals: 0,
                        lastResetDate: new Date().toISOString().split('T')[0],
                        updatedAt: new Date(),
                        updatedBy: currentAgent || 'system'
                    });
                }
                
                await batch.commit();
                
                bankAccounts.forEach(account => {
                    account.currentDeposits = 0;
                    account.currentWithdrawals = 0;
                    account.lastResetDate = new Date().toISOString().split('T')[0];
                });
                
                updateBankAccountsUI();
                showSuccessMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ Ù„Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯!');
                
            } catch (error) {
                console.error('Error resetting bank accounts:', error);
                throw error;
            }
        }

        // ========== Ø¯Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠØ© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† ==========
        async function manualResetDailyLimits() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.')) {
                try {
                    await resetAllBankAccounts();
                } catch (error) {
                    showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©');
                }
            }
        }

        function checkAgentName() {
            const savedName = localStorage.getItem('agentName');
            if (savedName) {
                currentAgent = savedName;
                document.getElementById('agentName').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentAgent}`;
                registerAgentInDatabase();
            } else {
                document.getElementById('nameModal').classList.remove('hidden');
            }
        }

        async function registerAgentInDatabase() {
            try {
                const agentQuery = await db.collection('agents').where('name', '==', currentAgent).get();
                
                if (agentQuery.empty) {
                    await db.collection('agents').add({
                        name: currentAgent,
                        createdAt: new Date(),
                        isActive: true,
                        lastLogin: new Date()
                    });
                } else {
                    const agentDoc = agentQuery.docs[0];
                    await db.collection('agents').doc(agentDoc.id).update({
                        lastLogin: new Date()
                    });
                }
            } catch (error) {
                console.error('Error registering agent:', error);
            }
        }

        function setAgentName() {
            const name = document.getElementById('agentNameInput').value.trim();
            if (name) {
                currentAgent = name;
                localStorage.setItem('agentName', name);
                document.getElementById('agentName').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentAgent}`;
                document.getElementById('nameModal').classList.add('hidden');
                
                registerAgentInDatabase();
                loadPreviousBalance();
                loadDailyData();
                loadAllAgentTransactions();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            
            document.getElementById('tab-' + tabName).classList.remove('tab-inactive');
            document.getElementById('tab-' + tabName).classList.add('tab-active');
            
            if (tabName === 'summary') {
                updateSummary();
            } else if (tabName === 'statement') {
                updateStatement();
            }
        }

        function setupFormListeners() {
            document.getElementById('collectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addCollection();
            });

            document.getElementById('depositForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addDeposit();
            });

            document.getElementById('expenseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addExpense();
            });

            document.getElementById('deliveryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addDelivery();
            });

            document.getElementById('accountForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBankAccount();
            });
        }

        function toggleCollectionBankAccount() {
            const collectionType = document.getElementById('collectionType').value;
            const bankAccountContainer = document.getElementById('collectionBankAccountContainer');
            
            if (collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©') {
                bankAccountContainer.classList.remove('hidden');
                document.getElementById('collectionBankAccount').required = true;
            } else {
                bankAccountContainer.classList.add('hidden');
                document.getElementById('collectionBankAccount').required = false;
            }
        }

        function toggleDeliveryFields() {
            const deliveryType = document.getElementById('deliveryType').value;
            const label = document.querySelector('label[for="deliveryAgent"]');
            
            if (deliveryType === 'receive') {
                label.innerHTML = '<i class="fas fa-user-friends ml-2"></i>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ù…Ø³Ù„Ù…';
            } else if (deliveryType === 'send') {
                label.innerHTML = '<i class="fas fa-user-friends ml-2"></i>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ù…Ø³ØªÙ„Ù…';
            }
        }

        async function addCollection() {
            const loading = document.getElementById('collectionLoading');
            loading.classList.remove('hidden');

            const customerName = document.getElementById('customerName').value;
            const collectionType = document.getElementById('collectionType').value;
            const amount = parseFloat(document.getElementById('collectionAmount').value);
            const notes = document.getElementById('collectionNotes').value;
            
            let bankAccountId = '';
            let bankAccountName = '';
            
            if (collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©') {
                bankAccountId = document.getElementById('collectionBankAccount').value;
                const selectedAccount = bankAccounts.find(acc => acc.id === bankAccountId);
                if (selectedAccount) {
                    bankAccountName = selectedAccount.name;
                } else {
                    showSuccessMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ');
                    loading.classList.add('hidden');
                    return;
                }
            }

            const transaction = {
                type: 'collection',
                agent: currentAgent,
                customerName,
                collectionType,
                amount,
                notes,
                timestamp: new Date(),
                date: new Date().toISOString().split('T')[0]
            };

            if (collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©') {
                transaction.bankAccountId = bankAccountId;
                transaction.bankAccountName = bankAccountName;
                
                const account = bankAccounts.find(acc => acc.id === bankAccountId);
                if (account) {
                    const newWithdrawals = (account.currentWithdrawals || 0) + amount;
                    await db.collection('bankAccounts').doc(account.id).update({
                        currentWithdrawals: newWithdrawals
                    });
                    account.currentWithdrawals = newWithdrawals;
                    updateBankAccountsUI();
                }
            }

            try {
                await db.collection('transactions').add(transaction);
                dailyTransactions.push(transaction);
                allAgentTransactions.push(transaction);
                
                saveCustomerName(customerName);
                
                const formattedText = generateTransactionText(transaction);
                showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­ØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!', formattedText);
                
                document.getElementById('collectionForm').reset();
                toggleCollectionBankAccount();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                updateSummary();
                updateStatement();
                
            } catch (error) {
                console.error('Error adding collection:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­ØµÙŠÙ„');
            }

            loading.classList.add('hidden');
        }

        async function addDeposit() {
            const loading = document.getElementById('depositLoading');
            loading.classList.remove('hidden');

            const bankAccountId = document.getElementById('bankAccount').value;
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const notes = document.getElementById('depositNotes').value;

            const account = bankAccounts.find(acc => acc.id === bankAccountId);
            if (account && (account.currentDeposits || 0) + amount > account.limit) {
                showSuccessMessage('ØªØ¬Ø§ÙˆØ² Ø³Ù‚Ù Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø­Ø³Ø§Ø¨');
                loading.classList.add('hidden');
                return;
            }

            const transaction = {
                type: 'deposit',
                agent: currentAgent,
                bankAccount: account ? account.name : bankAccountId,
                bankAccountId: bankAccountId,
                amount,
                notes,
                timestamp: new Date(),
                date: new Date().toISOString().split('T')[0]
            };

            try {
                await db.collection('transactions').add(transaction);
                dailyTransactions.push(transaction);
                allAgentTransactions.push(transaction);
                
                if (account) {
                    const newCurrentDeposits = (account.currentDeposits || 0) + amount;
                    await db.collection('bankAccounts').doc(account.id).update({
                        currentDeposits: newCurrentDeposits
                    });
                    account.currentDeposits = newCurrentDeposits;
                    updateBankAccountsUI();
                }
                
                const formattedText = generateTransactionText(transaction);
                showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­!', formattedText);
                
                document.getElementById('depositForm').reset();
                
                if (bankAccountId) {
                    localStorage.setItem('defaultBankAccount', bankAccountId);
                    defaultBankAccount = bankAccountId;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                updateSummary();
                updateStatement();
                
            } catch (error) {
                console.error('Error adding deposit:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹');
            }

            loading.classList.add('hidden');
        }

        async function addExpense() {
            const loading = document.getElementById('expenseLoading');
            loading.classList.remove('hidden');

            const expenseType = document.getElementById('expenseType').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const description = document.getElementById('expenseDescription').value;

            const transaction = {
                type: 'expense',
                agent: currentAgent,
                expenseType,
                amount,
                description,
                timestamp: new Date(),
                date: new Date().toISOString().split('T')[0]
            };

            try {
                await db.collection('transactions').add(transaction);
                dailyTransactions.push(transaction);
                allAgentTransactions.push(transaction);
                
                const formattedText = generateTransactionText(transaction);
                showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­!', formattedText);
                
                document.getElementById('expenseForm').reset();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                updateSummary();
                updateStatement();
                
            } catch (error) {
                console.error('Error adding expense:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ');
            }

            loading.classList.add('hidden');
        }

        async function addDelivery() {
            const loading = document.getElementById('deliveryLoading');
            loading.classList.remove('hidden');

            const deliveryType = document.getElementById('deliveryType').value;
            const deliveryAgent = document.getElementById('deliveryAgent').value;
            const amount = parseFloat(document.getElementById('deliveryAmount').value);
            const notes = document.getElementById('deliveryNotes').value;

            const transaction = {
                type: 'delivery',
                agent: currentAgent,
                deliveryType,
                fromAgent: deliveryType === 'send' ? currentAgent : deliveryAgent,
                toAgent: deliveryType === 'receive' ? currentAgent : deliveryAgent,
                amount,
                notes,
                timestamp: new Date(),
                date: new Date().toISOString().split('T')[0]
            };

            try {
                await db.collection('transactions').add(transaction);
                dailyTransactions.push(transaction);
                allAgentTransactions.push(transaction);
                
                const formattedText = generateTransactionText(transaction);
                showSuccessMessage(`ØªÙ… ${deliveryType === 'receive' ? 'Ø§Ø³ØªÙ„Ø§Ù…' : 'ØªØ³Ù„ÙŠÙ…'} Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ù†Ø¬Ø§Ø­!`, formattedText);
                
                document.getElementById('deliveryForm').reset();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                updateSummary();
                updateStatement();
                
            } catch (error) {
                console.error('Error adding delivery:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©');
            }

            loading.classList.add('hidden');
        }

        function generateTransactionText(transaction) {
            const date = new Date(transaction.timestamp).toLocaleDateString('en-US');
            const time = new Date(transaction.timestamp).toLocaleTimeString('en-US');
            
            const collections = dailyTransactions.filter(t => t.type === 'collection');
            const deposits = dailyTransactions.filter(t => t.type === 'deposit');
            const expenses = dailyTransactions.filter(t => t.type === 'expense');
            const deliveries = dailyTransactions.filter(t => t.type === 'delivery');
            
            const totalCollections = collections.reduce((sum, t) => sum + t.amount, 0);
            const totalDeposits = deposits.reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === currentAgent);
            const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === currentAgent);
            
            const totalReceived = receivedDeliveries.reduce((sum, t) => sum + t.amount, 0);
            const totalSent = sentDeliveries.reduce((sum, t) => sum + t.amount, 0);
            
            const todayBalance = totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
            const currentBalance = previousBalance + todayBalance;
            
            let text = '';
            
            switch (transaction.type) {
                case 'collection':
                    text += `ğŸ’° *Ø¹Ù…Ù„ÙŠØ© ØªØ­ØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯Ø©*\n\n`;
                    text += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${transaction.agent}\n`;
                    text += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\n`;
                    text += `ğŸ• Ø§Ù„ÙˆÙ‚Øª: ${time}\n\n`;
                    text += `ğŸ‘¥ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${transaction.customerName}\n`;
                    text += `ğŸ“‹ Ø§Ù„Ù†ÙˆØ¹: ${transaction.collectionType}\n`;
                    
                    if (transaction.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' && transaction.bankAccountName) {
                        text += `ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ: ${transaction.bankAccountName}\n`;
                    }
                    
                    text += `ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(transaction.amount)} Ø±.Ø³\n`;
                    if (transaction.notes) {
                        text += `ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${transaction.notes}\n`;
                    }
                    break;
                    
                case 'deposit':
                    const account = bankAccounts.find(acc => acc.id === transaction.bankAccountId);
                    const remaining = account ? account.limit - (account.currentDeposits || 0) : 0;
                    
                    text += `ğŸ¦ *Ø¹Ù…Ù„ÙŠØ© Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø¯ÙŠØ¯Ø©*\n\n`;
                    text += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${transaction.agent}\n`;
                    text += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\n`;
                    text += `ğŸ• Ø§Ù„ÙˆÙ‚Øª: ${time}\n\n`;
                    text += `ğŸ›ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨: ${transaction.bankAccount}\n`;
                    text += `ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(transaction.amount)} Ø±.Ø³\n`;
                    text += `ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨: ${formatAmount(remaining)} Ø±.Ø³\n`;
                    if (transaction.notes) {
                        text += `ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${transaction.notes}\n`;
                    }
                    break;
                    
                case 'expense':
                    text += `ğŸ’¸ *Ø¹Ù…Ù„ÙŠØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯Ø©*\n\n`;
                    text += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${transaction.agent}\n`;
                    text += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\n`;
                    text += `ğŸ• Ø§Ù„ÙˆÙ‚Øª: ${time}\n\n`;
                    text += `ğŸ“‹ Ø§Ù„Ù†ÙˆØ¹: ${transaction.expenseType}\n`;
                    text += `ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(transaction.amount)} Ø±.Ø³\n`;
                    text += `ğŸ“‹ Ø§Ù„ÙˆØµÙ: ${transaction.description}\n`;
                    break;
                    
                case 'delivery':
                    if (transaction.deliveryType === 'receive') {
                        text += `ğŸ“¥ *Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªÙ„Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø©*\n\n`;
                    } else {
                        text += `ğŸ“¤ *Ø¹Ù…Ù„ÙŠØ© ØªØ³Ù„ÙŠÙ… Ø¬Ø¯ÙŠØ¯Ø©*\n\n`;
                    }
                    text += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${transaction.agent}\n`;
                    text += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\n`;
                    text += `ğŸ• Ø§Ù„ÙˆÙ‚Øª: ${time}\n\n`;
                    
                    if (transaction.deliveryType === 'receive') {
                        text += `ğŸ‘¤ Ù…Ù†: ${transaction.fromAgent}\n`;
                    } else {
                        text += `ğŸ‘¤ Ø¥Ù„Ù‰: ${transaction.toAgent}\n`;
                    }
                    text += `ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(transaction.amount)} Ø±.Ø³\n`;
                    if (transaction.notes) {
                        text += `ğŸ“ Ø§Ù„Ø³Ø¨Ø¨: ${transaction.notes}\n`;
                    }
                    break;
            }
            
            text += `\nğŸ’° *Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${formatAmount(currentBalance)} Ø±.Ø³*`;
            
            return text;
        }

        function showSuccessMessage(message, shareText = null) {
            document.getElementById('successText').textContent = message;
            document.getElementById('successMessage').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('successMessage').classList.add('hidden');
                if (shareText) {
                    document.getElementById('shareText').value = shareText;
                    document.getElementById('shareModal').classList.remove('hidden');
                }
            }, 3000);
        }

        function saveCustomerName(name) {
            let customers = JSON.parse(localStorage.getItem('customers') || '[]');
            if (!customers.includes(name)) {
                customers.push(name);
                localStorage.setItem('customers', JSON.stringify(customers));
                loadCustomers();
            }
        }

        function loadCustomers() {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            const datalist = document.getElementById('customersList');
            datalist.innerHTML = '';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer;
                datalist.appendChild(option);
            });
        }

        async function loadBankAccounts() {
            try {
                const snapshot = await db.collection('bankAccounts').get();
                bankAccounts = [];
                
                snapshot.forEach(doc => {
                    bankAccounts.push({ id: doc.id, ...doc.data() });
                });
                
                updateBankAccountsUI();
                
                defaultBankAccount = localStorage.getItem('defaultBankAccount');
                if (defaultBankAccount && bankAccounts.find(acc => acc.id === defaultBankAccount)) {
                    document.getElementById('bankAccount').value = defaultBankAccount;
                }
                
            } catch (error) {
                console.error('Error loading bank accounts:', error);
            }
        }

        function updateBankAccountsUI() {
            const depositSelect = document.getElementById('bankAccount');
            const collectionSelect = document.getElementById('collectionBankAccount');
            
            if (depositSelect) {
                depositSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>';
                bankAccounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = `${account.name} - ${account.number}`;
                    depositSelect.appendChild(option);
                });
                
                if (defaultBankAccount && bankAccounts.find(acc => acc.id === defaultBankAccount)) {
                    depositSelect.value = defaultBankAccount;
                }
            }
            
            if (collectionSelect) {
                collectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>';
                bankAccounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = `${account.name} - ${account.number}`;
                    collectionSelect.appendChild(option);
                });
            }
            
            const accountsList = document.getElementById('bankAccountsList');
            if (!accountsList) return;
            
            accountsList.innerHTML = '';
            
            bankAccounts.forEach(account => {
                const remaining = account.limit - (account.currentDeposits || 0);
                const usedPercentage = ((account.currentDeposits || 0) / account.limit * 100).toFixed(1);
                
                const div = document.createElement('div');
                div.className = 'bank-card rounded-2xl p-4 md:p-6 relative overflow-hidden';
                div.innerHTML = `
                    <div class="account-actions">
                        <button type="button" onclick="editBankAccount('${account.id}')" class="account-action-btn btn-edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" onclick="confirmDeleteAccount('${account.id}', '${account.name}')" class="account-action-btn btn-delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-3 md:mb-4">
                            <div>
                                <h4 class="text-lg md:text-xl font-bold mb-1">${account.name}</h4>
                                <p class="text-xs md:text-sm opacity-80">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${account.number}</p>
                            </div>
                            <button type="button" onclick="shareAccountReport('${account.id}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-1 md:p-2 rounded-lg transition-all">
                                <i class="fas fa-share-alt text-white text-sm md:text-base"></i>
                            </button>
                        </div>
                        <div class="mb-3 md:mb-4">
                            <p class="card-number text-base md:text-lg font-mono tracking-wider">${account.cardNumber || 'â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢'}</p>
                            <p class="text-xs opacity-80 mt-1">${account.cardHolder || 'ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©'}</p>
                        </div>
                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-xs opacity-70">Ø§Ù„Ø³Ù‚Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ</p>
                                <p class="text-base md:text-lg font-bold">${formatAmount(account.limit)} Ø±.Ø³</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs opacity-70">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>
                                <p class="text-base md:text-lg font-bold ${remaining > 0 ? 'text-green-300' : 'text-red-300'}">
                                    ${formatAmount(remaining)} Ø±.Ø³
                                </p>
                            </div>
                        </div>
                        <div class="mt-3 md:mt-4 pt-3 md:pt-4 border-t border-white border-opacity-20">
                            <div class="flex justify-between text-xs md:text-sm">
                                <span class="opacity-70">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…:</span>
                                <span class="font-semibold">${formatAmount(account.currentDeposits || 0)} Ø±.Ø³ (${usedPercentage}%)</span>
                            </div>
                            <div class="w-full bg-white bg-opacity-20 rounded-full h-2 mt-2">
                                <div class="bg-white h-2 rounded-full transition-all" style="width: ${Math.min(((account.currentDeposits || 0) / account.limit) * 100, 100)}%"></div>
                            </div>
                        </div>
                        <div class="mt-2 text-xs">
                            <p class="opacity-70">Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(account.currentWithdrawals || 0)} Ø±.Ø³</p>
                        </div>
                    </div>
                `;
                accountsList.appendChild(div);
            });
        }

        async function loadAgents() {
            try {
                const snapshot = await db.collection('agents').get();
                const agents = [];
                
                snapshot.forEach(doc => {
                    const agentData = doc.data();
                    if (agentData.name !== currentAgent) {
                        agents.push(agentData.name);
                    }
                });
                
                const select = document.getElementById('deliveryAgent');
                if (select) {
                    select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</option>';
                    
                    agents.forEach(agent => {
                        const option = document.createElement('option');
                        option.value = agent;
                        option.textContent = agent;
                        select.appendChild(option);
                    });
                }

                // Update edit delivery agent dropdown
                const editDeliveryAgent = document.getElementById('editDeliveryAgent');
                if (editDeliveryAgent) {
                    editDeliveryAgent.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</option>';
                    
                    agents.forEach(agent => {
                        const option = document.createElement('option');
                        option.value = agent;
                        option.textContent = agent;
                        editDeliveryAgent.appendChild(option);
                    });
                }
                
            } catch (error) {
                console.error('Error loading agents:', error);
            }
        }

        async function loadPreviousBalance() {
            if (!currentAgent) return;
            
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            try {
                const savedBalance = localStorage.getItem(`balance_${currentAgent}_${yesterdayStr}`);
                if (savedBalance) {
                    previousBalance = parseFloat(savedBalance);
                    return;
                }
                
                const snapshot = await db.collection('transactions')
                    .where('agent', '==', currentAgent)
                    .where('date', '==', yesterdayStr)
                    .get();
                
                let collections = 0, deposits = 0, expenses = 0, received = 0, sent = 0;
                
                snapshot.forEach(doc => {
                    const transaction = doc.data();
                    switch (transaction.type) {
                        case 'collection':
                            collections += transaction.amount;
                            break;
                        case 'deposit':
                            deposits += transaction.amount;
                            break;
                        case 'expense':
                            expenses += transaction.amount;
                            break;
                        case 'delivery':
                            if (transaction.deliveryType === 'receive' && transaction.toAgent === currentAgent) {
                                received += transaction.amount;
                            } else if (transaction.deliveryType === 'send' && transaction.fromAgent === currentAgent) {
                                sent += transaction.amount;
                            }
                            break;
                    }
                });
                
                previousBalance = collections + received - deposits - expenses - sent;
                localStorage.setItem(`balance_${currentAgent}_${yesterdayStr}`, previousBalance.toString());
                
            } catch (error) {
                console.error('Error loading previous balance:', error);
                previousBalance = 0;
            }
        }

        async function loadDailyData() {
            if (!currentAgent) return;
            
            const today = new Date().toISOString().split('T')[0];
            
            try {
                const snapshot = await db.collection('transactions')
                    .where('agent', '==', currentAgent)
                    .where('date', '==', today)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                dailyTransactions = [];
                snapshot.forEach(doc => {
                    dailyTransactions.push({ id: doc.id, ...doc.data() });
                });
                
                updateSummary();
                
            } catch (error) {
                console.error('Error loading daily data:', error);
            }
        }

        async function loadAllAgentTransactions() {
            if (!currentAgent) return;
            
            try {
                const snapshot = await db.collection('transactions')
                    .where('agent', '==', currentAgent)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                allAgentTransactions = [];
                snapshot.forEach(doc => {
                    allAgentTransactions.push({ id: doc.id, ...doc.data() });
                });
                
            } catch (error) {
                console.error('Error loading all agent transactions:', error);
            }
        }

        function updateSummary() {
            const collections = dailyTransactions.filter(t => t.type === 'collection');
            const deposits = dailyTransactions.filter(t => t.type === 'deposit');
            const expenses = dailyTransactions.filter(t => t.type === 'expense');
            const deliveries = dailyTransactions.filter(t => t.type === 'delivery');
            
            const totalCollections = collections.reduce((sum, t) => sum + t.amount, 0);
            const totalDeposits = deposits.reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === currentAgent);
            const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === currentAgent);
            
            const totalReceived = receivedDeliveries.reduce((sum, t) => sum + t.amount, 0);
            const totalSent = sentDeliveries.reduce((sum, t) => sum + t.amount, 0);
            
            const todayBalance = totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
            const remainingBalance = previousBalance + todayBalance;
            
            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem(`balance_${currentAgent}_${today}`, remainingBalance.toString());
            
            document.getElementById('previousBalance').textContent = formatAmount(previousBalance);
            document.getElementById('totalCollections').textContent = formatAmount(totalCollections);
            document.getElementById('totalDeposits').textContent = formatAmount(totalDeposits);
            document.getElementById('totalExpenses').textContent = formatAmount(totalExpenses);
            document.getElementById('remainingBalance').textContent = formatAmount(remainingBalance);
            
            const transactionsList = document.getElementById('dailyTransactions');
            if (!transactionsList) return;
            
            transactionsList.innerHTML = '';
            
            if (dailyTransactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="text-center py-8 md:py-12">
                        <i class="fas fa-calendar-day text-4xl md:text-6xl text-gray-300 mb-3 md:mb-4"></i>
                        <p class="text-lg md:text-xl text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        <p class="text-gray-400 text-sm md:text-base">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ©</p>
                    </div>
                `;
                return;
            }
            
            dailyTransactions.forEach(transaction => {
                const div = document.createElement('div');
                div.className = 'transaction-item rounded-xl p-4 md:p-6 flex flex-col md:flex-row md:justify-between md:items-center space-y-3 md:space-y-0';
                
                let content = '';
                const time = formatDateTime(transaction.timestamp);
                let iconClass = '';
                let colorClass = '';
                
                switch (transaction.type) {
                    case 'collection':
                        iconClass = 'fas fa-arrow-up';
                        colorClass = 'text-green-600';
                        let collectionDetails = `Ù…Ù† ${transaction.customerName}`;
                        
                        if (transaction.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' && transaction.bankAccountName) {
                            collectionDetails += ` - ${transaction.bankAccountName}`;
                        } else {
                            collectionDetails += ` - ${transaction.collectionType}`;
                        }
                        
                        content = `
                            <div class="flex items-center">
                                <div class="bg-green-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                                    <i class="${iconClass} ${colorClass}"></i>
                                </div>
                                <div>
                                    <span class="font-bold ${colorClass}">ØªØ­ØµÙŠÙ„</span>
                                    <span class="text-gray-600 block text-sm md:text-base">${collectionDetails}</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="font-bold text-lg md:text-xl ${colorClass}">+${formatAmount(transaction.amount)}</span>
                                <span class="text-xs md:text-sm text-gray-500">${time}</span>
                                <div class="transaction-actions">
                                    <button type="button" onclick="editTransaction('${transaction.id}')" class="btn-edit text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" onclick="deleteTransaction('${transaction.id}')" class="btn-delete text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <button type="button" onclick="shareTransaction('${transaction.id}')" class="btn-share text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-share"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        break;
                    case 'deposit':
                        iconClass = 'fas fa-university';
                        colorClass = 'text-blue-600';
                        content = `
                            <div class="flex items-center">
                                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                                    <i class="${iconClass} ${colorClass}"></i>
                                </div>
                                <div>
                                    <span class="font-bold ${colorClass}">Ø¥ÙŠØ¯Ø§Ø¹</span>
                                    <span class="text-gray-600 block text-sm md:text-base">ÙÙŠ ${transaction.bankAccount}</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="font-bold text-lg md:text-xl ${colorClass}">-${formatAmount(transaction.amount)}</span>
                                <span class="text-xs md:text-sm text-gray-500">${time}</span>
                                <div class="transaction-actions">
                                    <button type="button" onclick="editTransaction('${transaction.id}')" class="btn-edit text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" onclick="deleteTransaction('${transaction.id}')" class="btn-delete text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <button type="button" onclick="shareTransaction('${transaction.id}')" class="btn-share text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-share"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        break;
                    case 'expense':
                        iconClass = 'fas fa-arrow-down';
                        colorClass = 'text-red-600';
                        content = `
                            <div class="flex items-center">
                                <div class="bg-red-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                                    <i class="${iconClass} ${colorClass}"></i>
                                </div>
                                <div>
                                    <span class="font-bold ${colorClass}">Ù…ØµØ±ÙˆÙ</span>
                                    <span class="text-gray-600 block text-sm md:text-base">${transaction.expenseType}</span>
                                    <span class="text-xs text-gray-500">${transaction.description}</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="font-bold text-lg md:text-xl ${colorClass}">-${formatAmount(transaction.amount)}</span>
                                <span class="text-xs md:text-sm text-gray-500">${time}</span>
                                <div class="transaction-actions">
                                    <button type="button" onclick="editTransaction('${transaction.id}')" class="btn-edit text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" onclick="deleteTransaction('${transaction.id}')" class="btn-delete text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <button type="button" onclick="shareTransaction('${transaction.id}')" class="btn-share text-white px-2 py-1 rounded text-xs">
                                        <i class="fas fa-share"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive') {
                            iconClass = 'fas fa-download';
                            colorClass = 'text-green-600';
                            content = `
                                <div class="flex items-center">
                                    <div class="bg-green-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                                        <i class="${iconClass} ${colorClass}"></i>
                                    </div>
                                    <div>
                                        <span class="font-bold ${colorClass}">Ø§Ø³ØªÙ„Ø§Ù…</span>
                                        <span class="text-gray-600 block text-sm md:text-base">Ù…Ù† ${transaction.fromAgent}</span>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="font-bold text-lg md:text-xl ${colorClass}">+${formatAmount(transaction.amount)}</span>
                                    <span class="text-xs md:text-sm text-gray-500">${time}</span>
                                    <div class="transaction-actions">
                                        <button type="button" onclick="editTransaction('${transaction.id}')" class="btn-edit text-white px-2 py-1 rounded text-xs">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" onclick="deleteTransaction('${transaction.id}')" class="btn-delete text-white px-2 py-1 rounded text-xs">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button type="button" onclick="shareTransaction('${transaction.id}')" class="btn-share text-white px-2 py-1 rounded text-xs">
                                            <i class="fas fa-share"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        } else {
                            iconClass = 'fas fa-upload';
                            colorClass = 'text-red-600';
                            content = `
                                <div class="flex items-center">
                                    <div class="bg-red-100 p-2 md:p-3 rounded-full ml-3 md:ml-4">
                                        <i class="${iconClass} ${colorClass}"></i>
                                    </div>
                                    <div>
                                        <span class="font-bold ${colorClass}">ØªØ³Ù„ÙŠÙ…</span>
                                        <span class="text-gray-600 block text-sm md:text-base">Ø¥Ù„Ù‰ ${transaction.toAgent}</span>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="font-bold text-lg md:text-xl ${colorClass}">-${formatAmount(transaction.amount)}</span>
                                    <span class="text-xs md:text-sm text-gray-500">${time}</span>
                                    <div class="transaction-actions">
                                        <button type="button" onclick="editTransaction('${transaction.id}')" class="btn-edit text-white px-2 py-1 rounded text-xs">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" onclick="deleteTransaction('${transaction.id}')" class="btn-delete text-white px-2 py-1 rounded text-xs">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button type="button" onclick="shareTransaction('${transaction.id}')" class="btn-share text-white px-2 py-1 rounded text-xs">
                                            <i class="fas fa-share"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                        break;
                }
                
                div.innerHTML = content;
                transactionsList.appendChild(div);
            });
        }

        // ========== ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ ==========
        function updateStatement() {
            const statementContent = document.getElementById('statementContent');
            if (!statementContent) return;
            
            if (allAgentTransactions.length === 0) {
                statementContent.innerHTML = `
                    <div class="text-center py-8 md:py-12">
                        <i class="fas fa-file-invoice text-4xl md:text-6xl text-gray-300 mb-3 md:mb-4"></i>
                        <p class="text-lg md:text-xl text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</p>
                        <p class="text-gray-400 text-sm md:text-base">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ©</p>
                    </div>
                `;
                return;
            }
            
            let runningBalance = 0;
            const statementData = [];

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            allAgentTransactions.forEach(transaction => {
                let amount = transaction.amount || 0;
                
                switch (transaction.type) {
                    case 'collection':
                        runningBalance += amount;
                        break;
                    case 'deposit':
                        runningBalance -= amount;
                        break;
                    case 'expense':
                        runningBalance -= amount;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive' && transaction.toAgent === currentAgent) {
                            runningBalance += amount;
                        } else if (transaction.deliveryType === 'send' && transaction.fromAgent === currentAgent) {
                            runningBalance -= amount;
                        }
                        break;
                }

                statementData.push({
                    date: formatDateTime(transaction.timestamp),
                    type: transaction.type,
                    description: getTransactionDescription(transaction),
                    amount: amount,
                    balance: runningBalance
                });
            });

            statementContent.innerHTML = `
                <div class="bg-white rounded-lg p-4 md:p-6">
                    <h4 class="text-lg md:text-xl font-bold text-gray-800 mb-4">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ØªØ±Ø§ÙƒÙ…ÙŠ - ${currentAgent}</h4>
                    <div class="overflow-x-auto">
                        <table class="statement-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„ÙˆØµÙ</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${statementData.map(item => `
                                    <tr>
                                        <td>${item.date}</td>
                                        <td>${getTypeArabicName(item.type)}</td>
                                        <td>${item.description}</td>
                                        <td class="${getAmountColor(item.type, item.amount)}">${formatAmount(item.amount)}</td>
                                        <td class="${item.balance >= 0 ? 'text-green-600' : 'text-red-600'}">${formatAmount(item.balance)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <p class="text-lg font-bold ${runningBalance >= 0 ? 'text-green-600' : 'text-red-600'}">
                            Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${formatAmount(runningBalance)} Ø±ÙŠØ§Ù„
                        </p>
                    </div>
                </div>
            `;
        }

        function getTransactionDescription(transaction) {
            switch (transaction.type) {
                case 'collection':
                    return `ØªØ­ØµÙŠÙ„ Ù…Ù† ${transaction.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} - ${transaction.collectionType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                case 'deposit':
                    return `Ø¥ÙŠØ¯Ø§Ø¹ ÙÙŠ ${transaction.bankAccount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                case 'expense':
                    return `Ù…ØµØ±ÙˆÙ ${transaction.expenseType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} - ${transaction.description || ''}`;
                case 'delivery':
                    if (transaction.deliveryType === 'receive') {
                        return `Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† ${transaction.fromAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                    } else {
                        return `ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ ${transaction.toAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                    }
                default:
                    return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        }

        function getTypeArabicName(type) {
            const types = {
                'collection': 'ØªØ­ØµÙŠÙ„',
                'deposit': 'Ø¥ÙŠØ¯Ø§Ø¹',
                'expense': 'Ù…ØµØ±ÙˆÙ',
                'delivery': 'Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ…'
            };
            return types[type] || type;
        }

        function getAmountColor(type, amount) {
            if (type === 'collection' || (type === 'delivery' && amount > 0)) {
                return 'text-green-600';
            }
            return 'text-red-600';
        }

        function generateStatementReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            doc.setFontSize(16);
            
            const today = new Date().toLocaleDateString('en-US');
            
            let yPosition = 20;
            
            doc.text('ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ØªØ±Ø§ÙƒÙ…ÙŠ - Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª', 20, yPosition);
            yPosition += 10;
            doc.text(`Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${currentAgent}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}`, 20, yPosition);
            yPosition += 20;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            let runningBalance = 0;
            allAgentTransactions.forEach(transaction => {
                let amount = transaction.amount || 0;
                
                switch (transaction.type) {
                    case 'collection':
                        runningBalance += amount;
                        break;
                    case 'deposit':
                        runningBalance -= amount;
                        break;
                    case 'expense':
                        runningBalance -= amount;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive' && transaction.toAgent === currentAgent) {
                            runningBalance += amount;
                        } else if (transaction.deliveryType === 'send' && transaction.fromAgent === currentAgent) {
                            runningBalance -= amount;
                        }
                        break;
                }
            });
            
            doc.text(`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${formatAmount(runningBalance)} Ø±.Ø³`, 20, yPosition);
            
            doc.save(`statement-${currentAgent}-${today}.pdf`);
        }

        function shareStatement() {
            let runningBalance = 0;
            const statementData = [];

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            allAgentTransactions.forEach(transaction => {
                let amount = transaction.amount || 0;
                
                switch (transaction.type) {
                    case 'collection':
                        runningBalance += amount;
                        break;
                    case 'deposit':
                        runningBalance -= amount;
                        break;
                    case 'expense':
                        runningBalance -= amount;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive' && transaction.toAgent === currentAgent) {
                            runningBalance += amount;
                        } else if (transaction.deliveryType === 'send' && transaction.fromAgent === currentAgent) {
                            runningBalance -= amount;
                        }
                        break;
                }

                statementData.push({
                    date: formatDateTime(transaction.timestamp),
                    type: getTypeArabicName(transaction.type),
                    description: getTransactionDescription(transaction),
                    amount: amount,
                    balance: runningBalance
                });
            });

            let report = `ğŸ¢ Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ“Š ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ØªØ±Ø§ÙƒÙ…ÙŠ\n`;
            report += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${currentAgent}\n`;
            report += `ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${new Date().toLocaleDateString('en-US')}\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            
            report += `ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ÙƒØ´Ù:\n`;
            report += `ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${formatAmount(runningBalance)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: ${allAgentTransactions.length}\n\n`;
            
            report += `ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:\n`;
            statementData.forEach((item, index) => {
                report += `${index + 1}. ${item.date} - ${item.type}\n`;
                report += `   ${item.description}\n`;
                report += `   Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(item.amount)} Ø±ÙŠØ§Ù„\n`;
                report += `   Ø§Ù„Ø±ØµÙŠØ¯: ${formatAmount(item.balance)} Ø±ÙŠØ§Ù„\n\n`;
            });

            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© ==========
        function showAddAccountModal() {
            document.getElementById('accountModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('accountForm').reset();
            document.getElementById('editAccountId').value = '';
            document.getElementById('accountModal').classList.remove('hidden');
        }

        function hideAccountModal() {
            document.getElementById('accountModal').classList.add('hidden');
        }

        function editBankAccount(accountId) {
            const account = bankAccounts.find(acc => acc.id === accountId);
            if (!account) return;
            
            document.getElementById('accountModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ';
            document.getElementById('editAccountId').value = account.id;
            document.getElementById('accountName').value = account.name;
            document.getElementById('accountNumber').value = account.number;
            document.getElementById('cardNumber').value = account.cardNumber || '';
            document.getElementById('cardHolder').value = account.cardHolder || '';
            document.getElementById('accountLimit').value = account.limit;
            
            document.getElementById('accountModal').classList.remove('hidden');
        }

        async function saveBankAccount() {
            const accountId = document.getElementById('editAccountId').value;
            const accountName = document.getElementById('accountName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const cardNumber = document.getElementById('cardNumber').value;
            const cardHolder = document.getElementById('cardHolder').value;
            const accountLimit = parseFloat(document.getElementById('accountLimit').value);
            
            const accountData = {
                name: accountName,
                number: accountNumber,
                cardNumber: cardNumber,
                cardHolder: cardHolder,
                limit: accountLimit,
                currentDeposits: 0,
                currentWithdrawals: 0,
                updatedAt: new Date(),
                updatedBy: currentAgent
            };
            
            try {
                if (accountId) {
                    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯
                    await db.collection('bankAccounts').doc(accountId).update(accountData);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    const index = bankAccounts.findIndex(acc => acc.id === accountId);
                    if (index !== -1) {
                        bankAccounts[index] = { ...bankAccounts[index], ...accountData };
                    }
                    
                    showSuccessMessage('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    accountData.createdAt = new Date();
                    const result = await db.collection('bankAccounts').add(accountData);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    bankAccounts.push({ id: result.id, ...accountData });
                    
                    showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                }
                
                updateBankAccountsUI();
                hideAccountModal();
                
            } catch (error) {
                console.error('Error saving bank account:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ');
            }
        }

        function confirmDeleteAccount(accountId, accountName) {
            accountToDelete = accountId;
            document.getElementById('deleteConfirmText').textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ "${accountName}"ØŸ`;
            document.getElementById('deleteConfirmModal').classList.remove('hidden');
        }

        function hideDeleteConfirmModal() {
            document.getElementById('deleteConfirmModal').classList.add('hidden');
            accountToDelete = null;
        }

        async function confirmDelete() {
            if (!accountToDelete) return;
            
            try {
                await db.collection('bankAccounts').doc(accountToDelete).delete();
                
                // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                bankAccounts = bankAccounts.filter(acc => acc.id !== accountToDelete);
                
                updateBankAccountsUI();
                showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                
            } catch (error) {
                console.error('Error deleting bank account:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ');
            }
            
            hideDeleteConfirmModal();
        }

        function shareAccountReport(accountId) {
            const account = bankAccounts.find(acc => acc.id === accountId);
            if (!account) return;
            
            const remaining = account.limit - (account.currentDeposits || 0);
            const usedPercentage = ((account.currentDeposits || 0) / account.limit * 100).toFixed(1);
            
            let report = `ğŸ¦ *ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ*\n\n`;
            report += `ğŸ›ï¸ Ø§Ù„Ø¨Ù†Ùƒ: ${account.name}\n`;
            report += `ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${account.number}\n`;
            if (account.cardNumber) {
                report += `ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${account.cardNumber}\n`;
            }
            if (account.cardHolder) {
                report += `ğŸ‘¤ ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${account.cardHolder}\n`;
            }
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            report += `ğŸ’° Ø§Ù„Ø³Ù‚Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${formatAmount(account.limit)} Ø±.Ø³\n`;
            report += `ğŸ“Š Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(account.currentDeposits || 0)} Ø±.Ø³ (${usedPercentage}%)\n`;
            report += `ğŸ’¸ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatAmount(remaining)} Ø±.Ø³\n`;
            report += `ğŸ’³ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(account.currentWithdrawals || 0)} Ø±.Ø³\n`;
            report += `ğŸ“… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleDateString('en-US')}\n`;
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function shareAllAccountsReport() {
            let report = `ğŸ¦ *ØªÙ‚Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©*\n\n`;
            report += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${currentAgent}\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('en-US')}\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            
            let totalLimit = 0;
            let totalUsed = 0;
            let totalRemaining = 0;
            let totalWithdrawals = 0;
            
            bankAccounts.forEach((account, index) => {
                const remaining = account.limit - (account.currentDeposits || 0);
                const usedPercentage = ((account.currentDeposits || 0) / account.limit * 100).toFixed(1);
                
                report += `${index + 1}. ${account.name}\n`;
                report += `   Ø§Ù„Ø³Ù‚Ù: ${formatAmount(account.limit)} Ø±.Ø³\n`;
                report += `   Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${formatAmount(account.currentDeposits || 0)} Ø±.Ø³ (${usedPercentage}%)\n`;
                report += `   Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatAmount(remaining)} Ø±.Ø³\n`;
                report += `   Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª: ${formatAmount(account.currentWithdrawals || 0)} Ø±.Ø³\n\n`;
                
                totalLimit += account.limit;
                totalUsed += (account.currentDeposits || 0);
                totalRemaining += remaining;
                totalWithdrawals += (account.currentWithdrawals || 0);
            });
            
            const totalUsedPercentage = ((totalUsed / totalLimit) * 100).toFixed(1);
            
            report += `ğŸ“Š *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ*\n`;
            report += `ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù‚Ù: ${formatAmount(totalLimit)} Ø±.Ø³\n`;
            report += `ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${formatAmount(totalUsed)} Ø±.Ø³ (${totalUsedPercentage}%)\n`;
            report += `ğŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatAmount(totalRemaining)} Ø±.Ø³\n`;
            report += `ğŸ’³ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª: ${formatAmount(totalWithdrawals)} Ø±.Ø³\n`;
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        // ========== ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ==========
        function editTransaction(transactionId) {
            const transaction = dailyTransactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            document.getElementById('editTransactionId').value = transaction.id;
            document.getElementById('editTransactionType').value = transaction.type;
            document.getElementById('editTransactionAmount').value = transaction.amount;
            document.getElementById('editTransactionNotes').value = transaction.notes || '';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
            document.getElementById('editCollectionFields').classList.add('hidden');
            document.getElementById('editDepositFields').classList.add('hidden');
            document.getElementById('editExpenseFields').classList.add('hidden');
            document.getElementById('editDeliveryFields').classList.add('hidden');
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
            switch (transaction.type) {
                case 'collection':
                    document.getElementById('editCollectionFields').classList.remove('hidden');
                    document.getElementById('editCustomerName').value = transaction.customerName || '';
                    document.getElementById('editCollectionType').value = transaction.collectionType || 'Ù†Ù‚Ø¯ÙŠ';
                    break;
                case 'deposit':
                    document.getElementById('editDepositFields').classList.remove('hidden');
                    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                    const bankSelect = document.getElementById('editBankAccount');
                    bankSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>';
                    bankAccounts.forEach(account => {
                        const option = document.createElement('option');
                        option.value = account.id;
                        option.textContent = `${account.name} - ${account.number}`;
                        if (transaction.bankAccountId === account.id) {
                            option.selected = true;
                        }
                        bankSelect.appendChild(option);
                    });
                    break;
                case 'expense':
                    document.getElementById('editExpenseFields').classList.remove('hidden');
                    document.getElementById('editExpenseType').value = transaction.expenseType || 'Ø£Ø®Ø±Ù‰';
                    document.getElementById('editExpenseDescription').value = transaction.description || '';
                    break;
                case 'delivery':
                    document.getElementById('editDeliveryFields').classList.remove('hidden');
                    document.getElementById('editDeliveryType').value = transaction.deliveryType || 'receive';
                    document.getElementById('editDeliveryAgent').value = 
                        transaction.deliveryType === 'receive' ? transaction.fromAgent : transaction.toAgent;
                    break;
            }
            
            document.getElementById('editTransactionModal').classList.remove('hidden');
        }

        function hideEditTransactionModal() {
            document.getElementById('editTransactionModal').classList.add('hidden');
        }

        function toggleEditTransactionFields() {
            const type = document.getElementById('editTransactionType').value;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
            document.getElementById('editCollectionFields').classList.add('hidden');
            document.getElementById('editDepositFields').classList.add('hidden');
            document.getElementById('editExpenseFields').classList.add('hidden');
            document.getElementById('editDeliveryFields').classList.add('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
            switch (type) {
                case 'collection':
                    document.getElementById('editCollectionFields').classList.remove('hidden');
                    break;
                case 'deposit':
                    document.getElementById('editDepositFields').classList.remove('hidden');
                    break;
                case 'expense':
                    document.getElementById('editExpenseFields').classList.remove('hidden');
                    break;
                case 'delivery':
                    document.getElementById('editDeliveryFields').classList.remove('hidden');
                    break;
            }
        }

        async function updateTransaction() {
            const transactionId = document.getElementById('editTransactionId').value;
            const type = document.getElementById('editTransactionType').value;
            const amount = parseFloat(document.getElementById('editTransactionAmount').value);
            const notes = document.getElementById('editTransactionNotes').value;
            
            const transaction = dailyTransactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
            let updateData = {
                amount: amount,
                notes: notes,
                updatedAt: new Date()
            };
            
            switch (type) {
                case 'collection':
                    updateData.customerName = document.getElementById('editCustomerName').value;
                    updateData.collectionType = document.getElementById('editCollectionType').value;
                    break;
                case 'deposit':
                    const bankAccountId = document.getElementById('editBankAccount').value;
                    const account = bankAccounts.find(acc => acc.id === bankAccountId);
                    if (account) {
                        updateData.bankAccount = account.name;
                        updateData.bankAccountId = bankAccountId;
                    }
                    break;
                case 'expense':
                    updateData.expenseType = document.getElementById('editExpenseType').value;
                    updateData.description = document.getElementById('editExpenseDescription').value;
                    break;
                case 'delivery':
                    updateData.deliveryType = document.getElementById('editDeliveryType').value;
                    const deliveryAgent = document.getElementById('editDeliveryAgent').value;
                    if (updateData.deliveryType === 'receive') {
                        updateData.fromAgent = deliveryAgent;
                        updateData.toAgent = currentAgent;
                    } else {
                        updateData.fromAgent = currentAgent;
                        updateData.toAgent = deliveryAgent;
                    }
                    break;
            }
            
            try {
                await db.collection('transactions').doc(transactionId).update(updateData);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                Object.assign(transaction, updateData);
                
                updateSummary();
                updateStatement();
                showSuccessMessage('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                hideEditTransactionModal();
                
            } catch (error) {
                console.error('Error updating transaction:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
            }
        }

        async function deleteTransaction(transactionId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©ØŸ')) return;
            
            try {
                await db.collection('transactions').doc(transactionId).delete();
                
                // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                dailyTransactions = dailyTransactions.filter(t => t.id !== transactionId);
                allAgentTransactions = allAgentTransactions.filter(t => t.id !== transactionId);
                
                updateSummary();
                updateStatement();
                showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                
            } catch (error) {
                console.error('Error deleting transaction:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
            }
        }

        function shareTransaction(transactionId) {
            const transaction = dailyTransactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            const formattedText = generateTransactionText(transaction);
            document.getElementById('shareText').value = formattedText;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        // ========== Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ==========
        function shareWorkData() {
            const collections = dailyTransactions.filter(t => t.type === 'collection');
            const deposits = dailyTransactions.filter(t => t.type === 'deposit');
            const expenses = dailyTransactions.filter(t => t.type === 'expense');
            const deliveries = dailyTransactions.filter(t => t.type === 'delivery');
            
            const totalCollections = collections.reduce((sum, t) => sum + t.amount, 0);
            const totalDeposits = deposits.reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === currentAgent);
            const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === currentAgent);
            
            const totalReceived = receivedDeliveries.reduce((sum, t) => sum + t.amount, 0);
            const totalSent = sentDeliveries.reduce((sum, t) => sum + t.amount, 0);
            
            const todayBalance = totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
            const currentBalance = previousBalance + todayBalance;
            
            let report = `ğŸ¢ Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨\n`;
            report += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${currentAgent}\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('en-US')}\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            
            report += `ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚: ${formatAmount(previousBalance)} Ø±.Ø³\n`;
            report += `ğŸ’µ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª: ${formatAmount(totalCollections)} Ø±.Ø³\n`;
            report += `ğŸ¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ${formatAmount(totalDeposits)} Ø±.Ø³\n`;
            report += `ğŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${formatAmount(totalExpenses)} Ø±.Ø³\n`;
            report += `ğŸ“¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${formatAmount(totalReceived)} Ø±.Ø³\n`;
            report += `ğŸ“¤ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù…: ${formatAmount(totalSent)} Ø±.Ø³\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            report += `ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${formatAmount(currentBalance)} Ø±.Ø³\n\n`;
            
            report += `ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:\n`;
            report += `â€¢ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª: ${collections.length} Ø¹Ù…Ù„ÙŠØ©\n`;
            report += `â€¢ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ${deposits.length} Ø¹Ù…Ù„ÙŠØ©\n`;
            report += `â€¢ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${expenses.length} Ø¹Ù…Ù„ÙŠØ©\n`;
            report += `â€¢ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${deliveries.length} Ø¹Ù…Ù„ÙŠØ©\n`;
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function shareReport() {
            let report = `ğŸ¢ Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…\n`;
            report += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${currentAgent}\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('en-US')}\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            
            report += `ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…:\n\n`;
            
            dailyTransactions.forEach((transaction, index) => {
                const time = formatDateTime(transaction.timestamp);
                let typeText = '';
                let amountText = '';
                
                switch (transaction.type) {
                    case 'collection':
                        typeText = `ØªØ­ØµÙŠÙ„ Ù…Ù† ${transaction.customerName}`;
                        amountText = `+${formatAmount(transaction.amount)}`;
                        break;
                    case 'deposit':
                        typeText = `Ø¥ÙŠØ¯Ø§Ø¹ ÙÙŠ ${transaction.bankAccount}`;
                        amountText = `-${formatAmount(transaction.amount)}`;
                        break;
                    case 'expense':
                        typeText = `Ù…ØµØ±ÙˆÙ ${transaction.expenseType}`;
                        amountText = `-${formatAmount(transaction.amount)}`;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive') {
                            typeText = `Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† ${transaction.fromAgent}`;
                            amountText = `+${formatAmount(transaction.amount)}`;
                        } else {
                            typeText = `ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ ${transaction.toAgent}`;
                            amountText = `-${formatAmount(transaction.amount)}`;
                        }
                        break;
                }
                
                report += `${index + 1}. ${time}\n`;
                report += `   ${typeText}\n`;
                report += `   Ø§Ù„Ù…Ø¨Ù„Øº: ${amountText} Ø±.Ø³\n`;
                if (transaction.notes) {
                    report += `   Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${transaction.notes}\n`;
                }
                report += `\n`;
            });
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function copyToClipboard() {
            const textarea = document.getElementById('shareText');
            textarea.select();
            document.execCommand('copy');
            showSuccessMessage('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
        }

        function hideShareModal() {
            document.getElementById('shareModal').classList.add('hidden');
        }

        // ========== Ø§Ù„ØªØµØ¯ÙŠØ± ==========
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            doc.setFontSize(16);
            
            const today = new Date().toLocaleDateString('en-US');
            
            let yPosition = 20;
            
            doc.text('ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ - Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª', 20, yPosition);
            yPosition += 10;
            doc.text(`Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${currentAgent}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}`, 20, yPosition);
            yPosition += 20;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            const collections = dailyTransactions.filter(t => t.type === 'collection');
            const deposits = dailyTransactions.filter(t => t.type === 'deposit');
            const expenses = dailyTransactions.filter(t => t.type === 'expense');
            const deliveries = dailyTransactions.filter(t => t.type === 'delivery');
            
            const totalCollections = collections.reduce((sum, t) => sum + t.amount, 0);
            const totalDeposits = deposits.reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === currentAgent);
            const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === currentAgent);
            
            const totalReceived = receivedDeliveries.reduce((sum, t) => sum + t.amount, 0);
            const totalSent = sentDeliveries.reduce((sum, t) => sum + t.amount, 0);
            
            const todayBalance = totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
            const currentBalance = previousBalance + todayBalance;
            
            doc.text(`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚: ${formatAmount(previousBalance)} Ø±.Ø³`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª: ${formatAmount(totalCollections)} Ø±.Ø³`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ${formatAmount(totalDeposits)} Ø±.Ø³`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${formatAmount(totalExpenses)} Ø±.Ø³`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${formatAmount(totalReceived)} Ø±.Ø³`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù…: ${formatAmount(totalSent)} Ø±.Ø³`, 20, yPosition);
            yPosition += 10;
            doc.text(`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${formatAmount(currentBalance)} Ø±.Ø³`, 20, yPosition);
            yPosition += 20;
            
            // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            doc.text('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:', 20, yPosition);
            yPosition += 10;
            
            dailyTransactions.forEach((transaction, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const time = formatDateTime(transaction.timestamp);
                let typeText = '';
                let amountText = '';
                
                switch (transaction.type) {
                    case 'collection':
                        typeText = `ØªØ­ØµÙŠÙ„ Ù…Ù† ${transaction.customerName}`;
                        amountText = `+${formatAmount(transaction.amount)}`;
                        break;
                    case 'deposit':
                        typeText = `Ø¥ÙŠØ¯Ø§Ø¹ ÙÙŠ ${transaction.bankAccount}`;
                        amountText = `-${formatAmount(transaction.amount)}`;
                        break;
                    case 'expense':
                        typeText = `Ù…ØµØ±ÙˆÙ ${transaction.expenseType}`;
                        amountText = `-${formatAmount(transaction.amount)}`;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive') {
                            typeText = `Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† ${transaction.fromAgent}`;
                            amountText = `+${formatAmount(transaction.amount)}`;
                        } else {
                            typeText = `ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ ${transaction.toAgent}`;
                            amountText = `-${formatAmount(transaction.amount)}`;
                        }
                        break;
                }
                
                doc.text(`${index + 1}. ${time} - ${typeText} - ${amountText} Ø±.Ø³`, 20, yPosition);
                yPosition += 10;
            });
            
            doc.save(`report-${currentAgent}-${today}.pdf`);
        }

        function exportToExcel() {
            const data = [];
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            data.push(['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ù†ÙˆØ¹', 'Ø§Ù„ÙˆØµÙ', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª']);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            dailyTransactions.forEach(transaction => {
                const time = formatDateTime(transaction.timestamp);
                let typeText = '';
                let description = '';
                
                switch (transaction.type) {
                    case 'collection':
                        typeText = 'ØªØ­ØµÙŠÙ„';
                        description = `Ù…Ù† ${transaction.customerName} - ${transaction.collectionType}`;
                        break;
                    case 'deposit':
                        typeText = 'Ø¥ÙŠØ¯Ø§Ø¹';
                        description = `ÙÙŠ ${transaction.bankAccount}`;
                        break;
                    case 'expense':
                        typeText = 'Ù…ØµØ±ÙˆÙ';
                        description = `${transaction.expenseType} - ${transaction.description}`;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive') {
                            typeText = 'Ø§Ø³ØªÙ„Ø§Ù…';
                            description = `Ù…Ù† ${transaction.fromAgent}`;
                        } else {
                            typeText = 'ØªØ³Ù„ÙŠÙ…';
                            description = `Ø¥Ù„Ù‰ ${transaction.toAgent}`;
                        }
                        break;
                }
                
                data.push([
                    time,
                    typeText,
                    description,
                    transaction.amount,
                    transaction.notes || ''
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„');
            
            const today = new Date().toLocaleDateString('en-US');
            XLSX.writeFile(wb, `report-${currentAgent}-${today}.xlsx`);
        }
    </script>
</body>
</html>
